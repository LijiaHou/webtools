# 从零构建koa项目Demo

## 初始化

1. 首先创建koaDemo文件夹，并进入koaDemo

2. npm init -y   生成package.json配置文件

3. npm install koa -S

   ​	注意：

   ​		`npm install xxx -S （--save）`自动把包添加到dependencies

   ​	    `npm install xxx -D （--save-dev）`自动把包添加到devdependencies(开发环境)

4. 创建js文件
   ```js
      const Koa = require('koa');

      const app = new Koa();

      app.use(ctx => {
      ctx.body = 'Hello Koa';
      });

      app.listen(3000);
   
   ```
   注意：这里使用require导入Koa，如果使用import，直接node运行会报错，还需要安装配置babel

5. 运行js文件
   
   `node .\src\hello.js `

6. 这时浏览器访问 127.0.0.1:3000 就通了

<br/>

## 安装babel的步骤：

为了使用es6的语法，我们安装babel，执行命令：
``` powershell
npm install -D babel-cli babel-preset-env
```

创建.babelrc文件
``` js
{
   "presets": ["babel-preset-env"]
}
```

执行命令,运行程序
```powershell
.\node_modules\.bin\babel-node .\src\hello.js
```

（不过就目前的情况来看，不装babel，import语法是用不了的，async貌似是可以）

<br/>

## 安装nodemon，使开发更便捷

`npm i nodemon -D`

然后在package.json中添加dev命令，这样每次src有改变，nodemon会自动帮我们重启项目

```json
"scripts": {
   "dev": "nodemon --watch src --exec babel-node src/index.js"
  },
```

## 安装 koa/router，创建一个欢迎首页

`npm i @koa/router -S`

注意路由的注册方式

```js
app.use(indexRouter.routes())
  .use(indexRouter.allowedMethods());
```

## 安装 koa-bodyparser

`npm install koa-bodyparser -S`

安装了koa-bodyparser后，可以直接用 ctx.request.body 访问请求体

<br/>
<br/>

# 实现功能

首先创建一个错误处理中间件，放在中间件的最上方，以便捕获到所有错误，返回状态码500